---
title: Configuring Keycloak Authentication Service in LobeChat
description: >-
  Learn how to configure the Keycloak authentication service in LobeChat,
  including deployment, creation, permission settings, and environment
  variables.
tags:
  - Keycloak Authentication
  - Environment Variable Configuration
  - Single Sign-On
  - LobeChat
---

# Configuring Keycloak Authentication Service in LobeChat

[Keycloak](https://www.keycloak.org/) is an open-source identity and access management solution that provides single sign-on, identity brokering, and social login features, suitable for modern applications and services.

<Callout type={'tip'}>
  &#x20; If you want to privately deploy Keycloak, we recommend using it together with LobeChat via Docker Compose deployment for easier service management.
</Callout>

## Keycloak Configuration Process

If you deploy using a local network IP, this guide assumes:

- Your LobeChat database version IP/port is `http://LOBECHAT_IP:3210`.
- Your privately deployed Keycloak domain is `http://KEYCLOAK_IP:8080`.

If you deploy using a public network, this guide assumes:

- Your LobeChat database version domain is `https://lobe.example.com`.
- Your privately deployed Keycloak domain is `https://lobe-auth-api.example.com`.

<Steps>
  &#x20; \### Create Keycloak Realm and Client

  &#x20; Access your privately deployed Keycloak admin console (default is `http://localhost:8080/admin`) and log in with the administrator account.

  &#x20; 1\. Create a new Realm
  &#x20;    \- Click the dropdown menu in the upper left corner and select "Create Realm"
  &#x20;    \- Enter a name, such as "LobeChat", then click "Create"

  &#x20; 2\. Create a Client
  &#x20;    \- Select "Clients" from the left menu, then click "Create client"
  &#x20;    \- Fill in the following information:
  &#x20;      \- Client ID: `lobechat`
  &#x20;      \- Client type: `OpenID Connect`
  &#x20;      \- Click "Next"
  &#x20;    \- On the "Capability config" page:
  &#x20;      \- Enable "Client authentication"
  &#x20;      \- Enable "Standard flow"
  &#x20;      \- Click "Next"
  &#x20;    \- On the "Login settings" page:
  &#x20;      \- Valid redirect URIs:
  &#x20;        \- Local development environment: `http://localhost:3210/api/auth/callback/keycloak`
  &#x20;        \- Local network IP deployment: `http://LOBECHAT_IP:3210/api/auth/callback/keycloak`
  &#x20;        \- Public environment: `https://lobe.example.com/api/auth/callback/keycloak`
  &#x20;      \- Web origins: Add your LobeChat domain or IP
  &#x20;      \- Click "Save"

  &#x20; 3\. Get Client Secret
  &#x20;    \- On the client details page, switch to the "Credentials" tab
  &#x20;    \- Copy the "Client secret" value, which will be needed later

  &#x20; \### Configure Users and Roles (Optional)

  &#x20; 1\. Create Users
  &#x20;    \- Select "Users" from the left menu, then click "Add user"
  &#x20;    \- Fill in the user information and click "Create"
  &#x20;    \- On the user details page, switch to the "Credentials" tab
  &#x20;    \- Set a password, and disable the "Temporary" option if needed
  &#x20;    \- Click "Set Password" to save

  &#x20; 2\. Create Roles and Permissions
  &#x20;    \- Select "Realm roles" from the left menu
  &#x20;    \- Click "Create role"
  &#x20;    \- Create necessary roles, such as "admin", "user", etc.
  &#x20;    \- Assign roles to users: On the user details page, switch to the "Role mapping" tab and assign appropriate roles

  &#x20; \### Disable Registration (Optional)

  &#x20; To ensure the security of your application, it's recommended to control Keycloak's registration functionality.

  &#x20; 1\. Select "Realm settings" from the left menu
  &#x20; 2\. Switch to the "Login" tab
  &#x20; 3\. In the "User registration" section, disable the "User registration" option
  &#x20; 4\. Click "Save" to save the settings

  &#x20; <Callout type={'warning'}>
  &#x20;   If registration is not disabled, anyone might be able to register and log in to your application. Please configure according to your security requirements.
  &#x20; </Callout>

  &#x20; \### Configure Environment Variables

  &#x20; Set the obtained client ID and client secret as `AUTH_KEYCLOAK_ID` and `AUTH_KEYCLOAK_SECRET` in the LobeChat environment variables.

  &#x20; Configure the LobeChat environment variable `AUTH_KEYCLOAK_ISSUER` as:

  &#x20; \- `http://localhost:8080/realms/LobeChat` for local development environment
  &#x20; \- `http://KEYCLOAK_IP:8080/realms/LobeChat` for privately deployed Keycloak on a local network
  &#x20; \- `https://lobe-auth-api.example.com/realms/LobeChat` for Keycloak deployed in a public environment

  &#x20; When deploying LobeChat, you need to configure the following environment variables:

  &#x20; \| Environment Variable      | Type     | Description                                                                                              |
  &#x20; \| ------------------------- | -------- | -------------------------------------------------------------------------------------------------------- |
  &#x20; \| `NEXT_AUTH_SECRET`        | Required | Key used to encrypt Auth.js session tokens. You can generate a key using: `openssl rand -base64 32`      |
  &#x20; \| `NEXT_AUTH_SSO_PROVIDERS` | Required | Select the single sign-on provider for LobeChat. For Keycloak, fill in `keycloak`.                      |
  &#x20; \| `AUTH_KEYCLOAK_ID`        | Required | Keycloak client ID                                                                                       |
  &#x20; \| `AUTH_KEYCLOAK_SECRET`    | Required | Keycloak client secret                                                                                   |
  &#x20; \| `AUTH_KEYCLOAK_ISSUER`    | Required | OpenID Connect issuer URL for the Keycloak provider, in the format `{keycloak_url}/realms/{realm_name}` |
  &#x20; \| `NEXTAUTH_URL`            | Required | This URL specifies the callback address for Auth.js during OAuth verification. Only needed when the default generated redirect address is incorrect. `https://lobe.example.com/api/auth` |

  &#x20; <Callout type={'tip'}>
  &#x20;   Visit [ðŸ“˜ Environment Variables](/zh/docs/self-hosting/environment-variables/auth#keycloak) for details on related variables.
  &#x20; </Callout>
</Steps>

<Callout type={'info'}>After successful deployment, users will be able to authenticate through Keycloak and use LobeChat.</Callout>
